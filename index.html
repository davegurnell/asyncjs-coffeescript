<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Caffeine Hit</title>

    <meta name="description" content="Coffeescript talk for AsyncJS">
    <meta name="author" content="Dave Gurnell">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/coffee.css" id="theme">
    <link rel="stylesheet" href="css/talk.css">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <script src="foo.js"></script>

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">

        <section data-markdown>
          <script type="text/template">
            # Caffeine Hit

            <img src="img/coffee-beans.jpg" alt="Mmmmm... coffee!">

            An exploration
            of [Coffeescript](http://coffeescript.org)
            by [@davegurnell](http://twitter.com/davegurnell)
            of [@mynaweb](http://twitter.com/mynaweb)

            <small>Image credit: <a href="http://www.flickr.com/photos/puuikibeach/3299635718/">Flickr user Puuikibeach</a></small>
          </script>
        </section>

        <section data-example>
          <h2>About me</h2>
          <script type="text/template">
            speaker =
              name:    'Dave Gurnell'
              twitter: '@davegurnell'
              website: 'http://davegurnell.com'

              roles: [
                {
                  role:    'co-founder'
                  company: 'Myna'
                  website: 'http://mynaweb.com'
                  doing:   'A/B testing for web and mobile'
                }

                {
                  role:    'director/developer'
                  company: 'Untyped'
                  website: 'http://untyped.com'
                  doing:   'full-stack web development, ux'
                }
              ]
          </script>
        </section>

        <section data-example>
          <h2>About Coffeescript</h2>
          <script type="text/template">
            coffeescript =
              name:    'Coffeescript'
              creator: 'Jeremy Ashkenas'
              ofFame:  'Backbone.js and Underscore.js'
              website: 'http://coffeescript.org'
              github:  'https://github.com/jashkenas/coffee-script'

            fib = (n) ->
              if n <= 2 then 1 else fib(n-1) + fib(n-2)
          </script>

          <aside class="notes">
            <p>It's a simple alternative syntax for Javascript - simple and terse</p>

            <p>Made by Jeremy Ashkenas - creator of Underscore and Backbone</p>

            <p>It compiles to Javascript - doesn't do anything more than JS does - nothing complex</p>

            <p>It makes functional programming easy by reducing the language impedance</p>

            <p>It makes you faster and helps you avoid bugs</p>
          </aside>
        </section>

        <section data-markdown>
          ## The agenda

          - Part 1: Motivation/syntax
          - Part 2: Important features
          - Part 3: Important gotchas
          - Part 4: Tools and debugging
        </section>

        <section data-markdown>
          ## Follow along at home...

          Play with the code for yourselves!

          [https://davegurnell.github.com/asyncjs-coffeescript]()
        </section>

        <section data-markdown>
          <script type="text/template">
            ## Part 1: Hello World

            <img src="img/hello-world.jpg" alt="Hello world">

            In which we meet our hero and have some fun with the compiler

            <small>Image credit: <a href="http://www.flickr.com/photos/oskay/472097903/">Windell Oskay</a></small>
          </script>
        </section>

        <section>
          <h2>Statements and Expressions</h2>

          <aside class="notes">
            <p>What's the difference between a statement and an expression?</p>
          </aside>
        </section>

        <section data-example data-mode="js">
          <h2 data-number>Statements and Expressions</h2>

          <script type="text/template">
            1 + 1

            for(var i = 0; i < 5; i++) {
              "doSomething"
            }

            if(a % 2 == 0) "even"; else "odd"

            function greet(name) {
              return "Hello " + name
            }

            greet("everyone")
          </script>

          <aside class="notes">
            <p>Which of these are statements and which are expressions?</p>

            <p>The proper answer is to look at the language semantics and see how things are defined</p>

            <p>We can get a pretty clear informal picture assigning them to variables or passing them to functions.</p>

            <p>Next slide - look at same set of statements and expressions in Coffeescript</p>
          </aside>
        </section>

        <!--
        <section data-example data-coffee="no">
          <h2 data-number>Statements and Expressions</h2>
          <script type="text/template">
            var a = 1 + 1

            var b = for(var i = 0; i < 5; i++) {
                      "doSomething"
                    }

            var c = if(a % 2 == 0) "even"; else "odd"

            var d = function (name) {
                      return "Hello " + name;
                    }

            var e = d("everyone")

            print(a, b, c, d, e)
          </script>

          <aside class="notes">
            <p>Compile error 1: "for" unexpected - can use underscore:</p>

            <pre>_.range(0, 10).map(function(num) { return "doSomething" })</pre>

            <p>Compile error 1: "if" unexpected - change to a ternary</p>
          </aside>
        </section>
        -->

        <section data-example>
          <h2 data-number>Statements and Expressions</h2>
          <script type="text/template">
            1 + 1

            for i in [0...5]
              "doSomething"

            if a % 2 == 0 then "even" else "odd"

            greet = (name) ->
              "Hello " + name

            greet("everyone")
          </script>

          <aside class="notes">
            <p>Almost *everything* is an expression in Coffeescript</p>

            <p>( Exceptions are a couple of imperative constrol constructs: return, break, etc )</p>

            <p>Very functional-style - similar to Lisp, Ruby, Haskell, Scala, etc etc</p>

            <p>The importance of this becomes apparent in a moment when we talk about functions</p>

            <p>For now, let's look at the core set of expressions...</p>
          </aside>
        </section>

        <section>
          <h2>Types of Expression</h2>
        </section>

        <section data-example>
          <h2 data-number>Conditionals</h2>
          <script type="text/template">
            x = 3

            if x % 2 == 0
              print('even')
            else
              print('odd')
          </script>

          <aside class="notes">
            <p>Very similar to a JS "if" - compiles to the same thing</p>

            <p>Coffeescript is indentation-based - positive and negative blocks are indented - no braces</p>

            <p>Can compress onto one line, but need "then" keyword to separate test from positive result</p>

            <p>Let's look at this in the context of expressions...</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Conditionals</h2>
          <script type="text/template">
            x = 3

            ans = if x % 2 == 0
                    'even'
                  else
                    'odd'

            print(ans)
          </script>

          <aside class="notes">
            <p>What is the value of "ans"?</p>

            <p>What about if we remove the "else" branch?</p>

            <p>Compile to see JS - equivalent to ternary expressions</p>

            <p>Add extra JS expressions to branches - compiled form becomes a larger ternary</p>

            <p>Add extra JS statements to branches - compiled form becomes an "if" inside a self-executing function</p>

            <p>Self-executing function is a trick CS uses to convert JS statements to expressions for an assignment. We'll see it again late. It's more to do with the assignment than the "if".</p>

            <p>Remove assignment - compiled form reverts to regular "if"</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Conditionals</h2>
          <script type="text/template">
            x = 3

            switch x
              when 1 then print('one')
              when 2 then print('two')
              when 3, 4, 5 then print('some')
              else print('many')
          </script>

          <aside class="notes">
            <p>Switch statements use "when" for "case" and "else" for "default"</p>

            <p>Need to use "then" in one-line "when" branches</p>

            <p>Automatic insertion of "break" - no follow-through</p>

            <p>Becomes interesting when using the resulting value...</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Conditionals</h2>
          <script type="text/template">
            x = 3

            ans =
              switch x
                when 1 then 'one'
                when 2 then 'two'
                when 3, 4, 5 then 'some'
                else 'many'

            print(ans)
          </script>

          <aside class="notes">
            <p>Coffeescript uses an anonymous function to convert the JS statement into an expression.</p>

            <p>You'll see the compiler do this when it has to. Not a huge performance concern on modern JS VMs, but does blow up your stack trace a little when debugging.</p>
          </aside>
        </section>

        <section data-example>
          <h2>Exception handling</h2>
          <script type="text/template">
            str = "abc"

            ans =
              try
                str.length
              catch exn
                "bad stuff happened"
              finally
                "done"

            print(ans)
          </script>

          <aside class="notes">
            <p>What is the value of ans?</p>

            <p>What if we remove the "catch" clause?</p>

            <p>Note that "finally" doesn't yield a value either way</p>

            <p>Note how this is compiled!</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Loops</h2>
          <script type="text/template">
            for [0..3]
              print("hi")
          </script>

          <aside class="notes">
            <p>This is the simplest "for" loop</p>

            <p>Iterates through a "range" of values</p>

            <p>Q. Inclusive or exclusive? Execute it and see.</p>

            <p>Can switch to exclusive by changing ".." to "..."</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Loops</h2>
          <script type="text/template">
            for x in [0..3]
              print(x)
          </script>

          <aside class="notes">
            <p>Add "x in" to get the value of the current item in the range</p>

            <p>But what's the value of the expression overall?</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Loops</h2>
          <script type="text/template">
            ans = for x in [0..15]
                    x

            print(ans)
          </script>

          <aside class="notes">
            <p>The value of the loop is an array of the values of the bodies in each iteration.</p>

            <p>Can change the expression in the loop to show that it's a bit like map.</p>

            <p>Can also show "by 3" and "when x%2 == 0".</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Loops</h2>
          <script type="text/template">
            array = [1, 1, 2, 3, 5, 8, 13]

            ans = for x, index in array
                    "array[" + index + "]=" + x

            print(ans)
          </script>

          <aside class="notes">
            <p>You can also iterate through an array.</p>

            <p>You can optionally use the index as you iterate.</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Loops</h2>
          <script type="text/template">
            obj = {a: 1, b: 2, c: 3 }

            ans = for key, value of obj
                    key + "=" + value

            print(ans)
          </script>

          <aside class="notes">
            <p>You can also loop through the keys in an object.</p>

            <p>You can optionally ask for the value as well.</p>

            <p>Note that this uses the keyword "of" instead of "in".</p>

            <p>The resulting value is an array, not an object.</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Loops</h2>
          <script type="text/template">
            x = 5

            ans1 = while x >= 0
                     x--

            ans2 = until x > 5
                     x++

            print(ans1, ans2)
          </script>

          <aside class="notes">
            <p>While follows similar semantics, but doesn't have "by" or "when" clauses</p>
          </aside>
        </section>

        <section>
          <h2>Take home points so far...</h2>

          <ul>
            <li>Everything in Coffeescript is an expression</li>
            <li>The compiler keeps things as close to regular JS as it can</li>
            <li>Sometimes extra variables and functions are needed</li>
          </ul>

          <aside class="notes">
            <p>Everyting is an expression - bear this in mind as we move onto functions...</p>
          </aside>
        </section>

        <section>
          <h2>Functions</h2>

          <aside class="notes">
            <p>Functions are reusable units of computation</p>

            <p>Fundamental to functional languages like JS and CS - use them all over the place</p>

            <p>Makes sense to keep the syntax light</p>
          </aside>
        </section>

        <section data-example data-mode="js">
          <h2 data-number>Functions</h2>
          <script type="text/template">
            // Q. How long is the shortest definition
            //    of an addition in Javascript?

            // A. 3 characters plus whitespace

            a + b

            // Q. How long is the shortest definition
            //    of an addition *function*?

            // A. ???

          </script>

          <aside class="notes">
            <p><code>function(a, b) { return a + b }</code> = 24 characters plus whitespace</p>

            <p>Lots of impedance here from the "function" keyword and "return" keyword</p>

            <p>Coffeescript eliminates both of these - let's look at the example again in Coffeescript</p>
          </aside>
        </section>

        <section data-example>
          <h2 >Functions</h2>
          <script type="text/template">
            # Q. How long is the shortest definition
            #    of an addition in Coffeescript?

            # A. 3 characters plus whitespace

            a + b

            # Q. How long is the shortest definition
            #    of an addition *function*?

            # A. ???

          </script>

          <aside class="notes">
            <p><code>(a, b) -> a + b</code> = 10 characters plus whitespace</p>

            <p>Must less impedence</p>

            <p>"Function" is replaced by "->", which is much shorter</p>

            <p>No "return" keyword - let's look at that...</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Functions</h2>
          <script type="text/template">
            ->

            (x) -> x

            (a, b) -> a + b

            () ->
              doStuff
              doStuff
              doStuff
              result
          </script>

          <aside class="notes">
            <p>The shortest function is just an arrow - this accepts no arguments and returns undefined</p>

            <p>If you want arguments, put parens on the left</p>

            <p>Functions always return the value of the last expression in the body</p>

            <p>Similar to Ruby, Lisp, Scala, Haskell, etc...</p>

            <p>Compile!</p>
          </aside>
        </section>

        <section data-example>
          <h2>Declarative style</h2>
          <script type="text/template">
            fib = (n) ->
              # ...implement the fibonacci function...

            # ...print the first 15 fibonacci numbers...
          </script>

          <aside class="notes">
            <p>The combination of everything-is-an-expression and the short function syntax lets us write some great reusable code in a declarative style</p>

            <p>Let's try some declarative programming - fibonacci numbers</p>
          </aside>
        </section>

        <section data-example>
          <h2>Functional style</h2>
          <script type="text/template">
            numbers = [1, 2, 3, 4, 5]

            find = (array, test) ->
              # ... implement a find function in recursive style...

            # print("first number over 3", find(numbers, ...))

            # print("first even number", find(numbers, ...))
          </script>

          <aside class="notes">
            <p>Now let's try some functional programming</p>
          </aside>
        </section>

        <section data-example>
          <h2>Explicit return</h2>
          <script type="text/template">
            numbers = [1, 2, 3, 4, 5]

            find = (array, test) ->
              # ... implement a find function in iterative style...

            print("first number over 3", find(numbers, (x) -> x > 3))

            print("first even number", find(numbers, (x) -> x % 2 == 0))
          </script>

          <aside class="notes">
            <p>You still have access to the "return" statement in Coffeescript</p>

            <p>It's one of the few statements that's actually a statement</p>

            <p>You can still program in imperative style</p>
          </aside>
        </section>

        <section data-example>
          <h2>Default arguments and splats</h2>
          <script type="text/template">
            greet = (name = "Dave") ->
              "Hello " + name

            greetAll = (names...) ->
              for name in names then greet(name)

            print(greetAll("Tim", "Daisy", "Mike", "Marsha", "Brian", "Twist"))
          </script>

          <aside class="notes">
            <p>Function arguments can have default values</p>

            <p>This is very pleasing</p>
          </aside>
        </section>
        <section data-example>
          <h2>Do expressions</h2>
          <script type="text/template">
            (->
              foo
              bar
              baz
            )()
          </script>

          <aside class="notes">
            <p>Developers don't just use JS functions to create re-usable code blocks</p>

            <p>Self-executing functions are the only way of introducing private variable scope</p>

            <p>Self-executing functions look like garbage in Coffeescript</p>

            <p>"do" syntax exists to provide this</p>
          </aside>
        </section>

        <section data-example>
          <h2>Function calls</h2>
          <script type="text/template">
            print("a", "b", "c")
          </script>

          <aside class="notes">
            <p>You can omit parentheses from function calls</p>

            <p>Still need commas to separate arguments</p>

            <p>This syntax has a lot of oddities - be wary when starting with it</p>

            <p>One really great use-case - jQuery callbacks</p>
          </aside>
        </section>

        <section>
          <h2>Variables, Literals and Scope</h2>
        </section>

        <section data-example>
          <h2 data-number>Literals</h2>
          <script type="text/template">
            string = "Dave"
            number = 34
            boolean = true
          </script>

          <aside class="notes">
            <p>Compile this - simple literals are the same as JS</p>

            <p>Ignore the "var" statements at the top - we'll come on to those in a minute</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Literals</h2>
          <script type="text/template">
            string = "Dave"
            number = 34
            boolean = true

            array = [ string, number, boolean ]
          </script>

          <aside class="notes">
            <p>Array literals are similar to JS too</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Literals</h2>
          <script type="text/template">
            string = "Dave"
            number = 34
            boolean = true

            object = { string, number, boolean }
          </script>

          <aside class="notes">
            <p>Coffeescript support ES6-style object shorthand</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Literals</h2>
          <script type="text/template">
            string = "Dave"
            number = 34
            boolean = true

            bracelessObject =
              string: string
              number: number
              boolean: boolean

            $.ajax 'http://api.example.com',
              data: { string, number }
              dataType: 'json'
          </script>

          <aside class="notes">
            <p>It also supports its own braceless-style object syntax</p>

            <p>This can be used in a special function call syntax - useful for methods where the last argument is a settings object</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Literals</h2>
          <script type="text/template">
            string = "Dave"
            number = 34
            boolean = true

            interpolatedString = "#{string} #{number} #{boolean} #{string + number}"
          </script>

          <aside class="notes">
            <p>String interpolation - Ruby style - allows you to embed full expressions inside strings</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Literals</h2>
          <script type="text/template">
            string = "Dave"
            number = 34
            boolean = true

            multiLineString =
              """
              A string #{string}
              A number #{number}
              A boolean #{boolean}
              An expression #{string + number}
              """
          </script>

          <aside class="notes">
            <p>Strings can be expanded multi-line. Indentation is removed from the compiled string.</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Scope</h2>
          <script type="text/template">
            a = 1
            b = 2
            c = 3
          </script>

          <aside class="notes">
            <p>Coffeescript auto-declares variables as "var"s for you - no global declarations</p>

            <p>Declarations are "hoisted" to the top of a block</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Scope</h2>
          <script type="text/template">
            a = 1

            func = ->
              b = 2

            do ->
              c = 3

          </script>

          <aside class="notes">
            <p>Blocks are: functions and "do" expressions</p>

            <p>The top level of a script is wrapped in a "do" expression to prevent accidental leaks into the global namespace</p>

            <p>You can break out of this top level wrapper by assigning to the "window" object</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Scope</h2>
          <script type="text/template">
            window.foo = "I escaped!"

            window.sum = (a, b) -> a + b

            # etc...
          </script>

          <aside class="notes">
            <p>The top level of a script is wrapped in a "do" expression to prevent accidental leaks into the global namespace</p>

            <p>You can break out of this top level wrapper by assigning to the "window" object</p>
          </aside>
        </section>

        <section>
          <h2>Part 2: Little treasures</h2>

          <p><img src="img/treasure-island.jpg" alt="Treasure island"></p>

          <p>In which we dig deep into some indispensable features</p>

          <p><small>Image credit: Flickr user <a href="http://www.flickr.com/photos/adplayers/7269497292/">Adplayers</a></small></p>
        </section>

        <section>
          <h2>Treasure #1: The Existential Operator</h2>
        </section>

        <section data-example data-mode="js">
          <h2 data-number>The Existential Operator</h2>
          <script type="text/template">
            // { name: string, lastLogin: date } -> string
            function greeting(options) {
              var name = options.name;
              var days = daysSince(options.lastLogin);

              return "Welcome back, " + name + ". " +
                     "You last logged in " + days + " days ago.";
            }

            // date date-or-null -> integer
            function daysSince(date, now) {
              now = now || new Date();
              return Math.floor((now.getTime() - date.getTime()) /
                                (24 * 60 * 60 * 1000));
            }

            alert(greeting({
              name: "Dave",
              lastLogin: new Date(2013, 3, 10)
            }));
          </script>

          <aside class="notes">
            <p>Here's a classic example.</p>

            <p>We have a <code>greeting</code> function that greets the player when they first log in to our app (note: use of <code>alert</code> in production apps is not advised).</p>

            <p>Let's rewrite this in Coffeescript...</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>The Existential Operator</h2>
          <script type="text/template">
            # { name: string, lastLogin: date } -> string
            greeting = (options) ->
              name = options.name
              days = daysSince(options.lastLogin)

              """
              Welcome back, #{name}.
              You last logged in #{days} days ago.
              """

            # date [date] -> integer
            daysSince = (date, now = new Date()) ->
              Math.floor((now.getTime() - date.getTime()) /
                         (24 * 60 * 60 * 1000))

            alert greeting
              name: "Dave"
              lastLogin: new Date(2013, 3, 10)
          </script>

          <aside class="notes">
            <p>Let's introduce a problem... If the user has never logged, lastLogin may not be set.</p>

            <p>What happens if we delete that key from the greeting object?</p>

            <p>We need to fix the error - put in an "if" statement... next slide.</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>The Existential Operator</h2>
          <script type="text/template">
            # { name: string, lastLogin: date } -> string
            greeting = (options) ->
              name = options.name
              last = options.lastLogin
              days = if last then daysSince(last) else null

              if days
                """
                Welcome back, #{name}.
                You last logged in #{days} days ago.
                """
              else
                "Welcome, #{name}."

            # date [date] -> integer
            daysSince = (date, now = new Date()) ->
              Math.floor((now.getTime() - date.getTime()) /
                         (24 * 60 * 60 * 1000))

            alert greeting
              name: "Dave"
              lastLogin: new Date(2013, 3, 10)
          </script>

          <aside class="notes">
            <p>Now there's a bug.</p>

            <p>With the date set to yesterday, this works.</p>
            <p>If we delete the date, this works.</p>
            <p>However, if we set the date to today, it doesn't work.</p>

            <p>The problem is that days is zero, which is a "falsy" value.</p>

            <p>With one character we can fix this! INSERT " ?" AND RETRY</p>
          </aside>
        </section>

        <section data-example>
          <h2>Postfix Existential Operator</h2>
          <script type="text/template">
            x = undefined

            print(x?)
          </script>

          <aside class="notes">
            <p>Let's compile this and see how it's implemented.</p>

            <p>Insert it into a couple of expressions. POSTFIX ONLY.</p>

            <pre>
            </pre>

            <p>Demo difference between "x? 1" and "x ? 1"</p>
          </aside>
        </section>

        <section data-example>
          <h2>Infix Existential Operator</h2>
          <script type="text/template">
            x = undefined
            y = "y"

            print(x ? y)
          </script>

          <aside class="notes">
            <p>The infix form allows us to substitute a default value.</p>

            <p>As you can imagine, this is great when destructuring objects full of options. Next slide.</p>
          </aside>
        </section>

        <section data-example>
          <h2>Infix Existential Operator</h2>
          <script type="text/template">
            options =
              name: "Dave"
              lastLogin: null
              # age: 34

            name = options.name      ? "No name"
            last = options.lastLogin ? new Date()
            age  = options.age       ? 21

            print(name, last, age)
          </script>

          <aside class="notes">
            <p>When objects become more complex, the accessor form of the operator comes into play.</p>
          </aside>
        </section>

        <section data-example>
          <h2>Existential Access Operator</h2>
          <script type="text/template">
            options =
              foo: { a: "fooA", b: "fooB" }
              bar: -> { x: "barX", y: "barY" }
              baz: null
          </script>

          <aside class="notes">
            <p>Describe object.</p>

            <p>Write accessors to grab "fooA" and "barX" and "bazI".</p>

            <p>One more form of the operator to discuss: assignment.</p>
          </aside>
        </section>

        <section data-example>
          <h2>Existential Assignment Operator</h2>
          <script type="text/template">
            x = undefined
            y = 0

            x ?= "defined"
            y ?= -1

            print(x, y)
          </script>

          <aside class="notes">
            <p>Just like "||=" except honors 0 and false.</p>

            <p>That covers the existential operator. If you like that, you'll love the next feature...</p>
          </aside>
        </section>

        <section>
          <h2>Treasure #2: Destructuring</h2>

          <aside class="notes">
            <p>This is the same destructuring syntax that's coming in ES6.</p>

            <p>Let's start with a simple example of one form: <em>destrucuting assignment</em>.</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Destructuring assignment</h2>
          <script type="text/template">
            a = 1
            b = 2

            [ a, b ] = [ b, a ]

            print(a, b)
          </script>

          <aside class="notes">
            <p>This is the classic example of this.</p>

            <p>Walk through it: construct array, pass through assignment operator, destructure on the left.</p>

            <p>Variables on the left don't have to be previously defined. Replace with [x, y]</p>

            <p>But this example doesn't capture the half of it...</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Destructuring assignment</h2>
          <script type="text/template">
            options =
              foo: { a: "fooA", b: "fooB" }
              bar: [ "bar1", "bar2", "bar3", "bar4", "bar5" ]
              baz: null
          </script>

          <aside class="notes">
            <p>Let's say we have data like this.</p>

            <p>Tasks on slide:</p>

            <ol>
              <li>Capture fooA, fooB</li>
              <li>Capture first three bars</li>
              <li>Capture first/last/mid bars</li>
            </ol>

            <p>This syntax goes beyond assignment...</p>
          </aside>
        </section>

        <section data-example>
          <h2>Destructuring arguments</h2>
          <script type="text/template">
            greeting = ({ name, lastLogin }) ->
              if lastLogin?
                """
                Welcome back, #{name}.
                You last logged in #{daysSince(lastLogin)} days ago.
                """
              else
                "Welcome, #{name}."

            # date [date] -> integer
            daysSince = (date, now = new Date()) ->
              Math.floor((now.getTime() - date.getTime()) /
                         (24 * 60 * 60 * 1000))

            alert greeting
              name: "Dave"
              lastLogin: new Date(2013, 3, 11)
          </script>

          <aside class="notes">
            <p>Any argument to a function can be specified in destructuring syntax.</p>

            <p>We can mix this with default arguments and splats for more powerful function headers.</p>
          </aside>
        </section>

        <section>
          <h2>Treasure #3: Classes and Objects</h2>

          <aside class="notes">
            <p>Who understands JS inheritance?</p>

            <p>How do you implement classes in JS? Many ways!</p>

            <p>Coffeescript has a pretty cood class system baked into the syntax.</p>

            <p>We'll look at some of the issues. First, let's see what we want to achieve.</p>
          </aside>
        </section>

        <section>
          <h2>Class System Wishlist...</h2>

          <p class="fragment" data-fragment-index="0">Classes and instances</p>
          <p class="fragment" data-fragment-index="1">Instances inherit properties from classes</p>
          <p class="fragment" data-fragment-index="2">Classes inherit properties from other classes</p>
          <p class="fragment" data-fragment-index="3">Method overriding / super calls</p>
          <p class="fragment" data-fragment-index="4">Simple test for class membership</p>

          <aside class="notes">
            <p>Discuss requirements.</p>

            <p>Next we'll see how to implement this using plain JS.</p>

            <p>Then we'll see how Coffeescript implements it.</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Prototype Chains</h2>
          <script type="text/template">
            obj = { a: 1, b: 2 }
            arr = [ 1, 2 ]
            fun = -> "foo"
          </script>

          <aside class="notes">
            <p>Objects, arrays, and functions in JS are all closely related. Technically, they're all types of object.</p>

            <p>Every object has a <em>prototype</em> that you can access using <code>Object.getPrototypeOf</code> method. Show this.</p>

            <p>All object literals have a prototype of <code>Object.prototype</code>. Show this.</p>

            <p><code>Object.prototype</code> is also an object. This means it has its own prototype.</p>

            <p>Arrays and functions are also types of object. They have different prototypes.</p>

            <p>Note that functions define a property called <code>prototype</code>. This is something else. We'll come to it below...</p>

            <p>What we get from all of this is a <em>prototype chain</em>. Let's take a look. Next slide.</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Prototype Chains</h2>
          <script type="text/template">
            obj = { a: 1, b: 2 }
            arr = [ 1, 2 ]
            fun = -> "foo"

            # Prototype chain of obj, including obj itself.
            prototypeChain = (obj) ->
              if obj?
                [ obj, prototypeChain(Object.getPrototypeOf(obj))... ]
              else
                [ obj ]

            console.log prototypeChain(obj)
            console.log prototypeChain(arr)
            console.log prototypeChain(fun)
          </script>

          <aside class="notes">
            <p>Examine the prototype chains. obj->Obj->null, fn->Fun->Obj->null, etc.</p>

            <p>The key thing is what happens when you access a property on an object.</p>

            <ul>
            <li>If that object has its own property with that name, that's what you get.</li>
            <li>If it doesn't have that property, we skip up the chain and look again.</li>
            <li>If we don't find fin the property by the end of the chain, we return <code>undefined</code>.</li>
            </ul>

            <p>This is how we get all of those common properties like <code>call</code> and <code>bind</code> (from <code>Function.prototype</code>) and <code>length</code> (from <code>Array.prototype</code>).</p>

            <p>It's also where methods like <code>$.isArray</code> and <code>$.isFunction</code> come from - they test the prototype chain for the presence of <code>Array.prototype</code> and <code>Function.prototype</code>.</p>

            <p>In JS we can manipulate the prototype chain to link objects together how we want. There are a couple of ways. We'll talk about the lowest common denominator.</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Constructor Functions</h2>
          <script type="text/template">
            Animal = (noise) ->
              this.noise = noise

              this.speak = ->
                print this.noise
                return

              return

            dog   = new Animal("bark")
            horse = new Animal("whinney")

            dog.speak()
            horse.speak()
          </script>

          <aside class="notes">
            <p>The classic way of setting up a prototype chain is with a constructor function.</p>

            <p>We use the <code>new</code> operator to create objects from the function. Most of us are used to this. If you're not, though, it seems like madness.</p>

            <p>We get a lot of the basics of our class system from this: independent instances and classes.</p>

            <p>Show dog != horse</p>

            <p>Look at the prototype chains of <code>dog</code> and <code>Animal</code>. Show that <code>Animal</code> isn't part of <code>dog's</code> inheritance chain. It's a constructor function, not a class.</p>

            <pre>console.log _.contains(prototypeChain(dog), Animal)</pre>

            <p>Now notice something odd. dog.speak != horse.speak</p>

            <p><code>speak</code> is copied between the objects - it isn't shared. We have no concept of common functionality. That's what a class is - how do we achieve that?</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Constructor Functions</h2>
          <script type="text/template">
            Animal = (noise) ->
              this.noise = noise

            Animal.prototype.speak = ->
              print this.noise

            dog   = new Animal("bark")
            horse = new Animal("whinney")

            print dog instanceof Animal

            dog.speak()
            horse.speak()

            print dog.speak == horse.speak
          </script>

          <aside class="notes">
            <p>Every function has a <code>prototype</code> property that we can use to manipulate the prototype chain on the objects it creates.</p>

            <p>This is NOT the prototype of the function itself. It's the prototype of the instances it creates:</p>

            <pre>
            print Object.getPrototypeOf(Animal) == Animal.prototype
            print Object.getPrototypeOf(dog) == Animal.prototype
            </pre>

            <p>The prototype property allows us to create shared state between our instances. It's acting like our class.</p>
          </aside>
        </section>

        <section data-example>
          <h2>Inheritance</h2>
          <script type="text/template">
            Animal = (noise) ->
              this.noise = noise

            Animal.prototype.speak = ->
              print this.noise

            Dog = (name) ->
              this.name = name

            # Missing line here...

            Dog.prototype.comeHere = (name) ->
              switch name
                when this.name then print "coming!"
                else                print "nope!"

            bonzo = new Dog("Bonzo")

            print bonzo instanceof Dog
            print bonzo instanceof Animal

            bonzo.comeHere("Fido")
            bonzo.speak()
          </script>

          <aside class="notes">
            <p>Now let's turn dogs into a subclass of animals.</p>

            <p>In the code here we've set up two constructors, Dog and Animal, each with a method on their prototype.</p>

            <p>We haven't linked them together, so dogs aren't animals yet and they don't speak().</p>

            <p>How do we set up the prototype chain to cause Dog to be a subclass of Animal?</p>

            <ul>
            <li>Not Dog.prototype = Animal - it's a constructor function!</li>
            <li>We have to link Dog's prototype to an <em>instance</em> of Animal.</li>
            </ul>

            <p>Dog.prototype = new Animal("bark")</p>

            <p>Now, each dog has a separate noise and name, and each has a shared prototype chain. Things we haven't dealt with:</p>

            <ul>
              <li>You can't specify the noise in the constructor to dog. It's possible to do this with a couple of levels of indirection.</li>

              <li>There's no concept of static methods or properties.</li>

              <li>There're no super calls - we can call methods directly on prototypes, but we have to hard-code the prototype names.</li>

              <li>It's easy to override <strong>this</strong> and cause the methods to mess up.</li>
            </ul>

            <p>It's getting pretty hairy now. Let's leave this, suffice to say that implementing flexible inheritance in Javascript is tricky</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Coffeescript Classes</h2>
          <script type="text/template">
            class Animal
              constructor: (noise) ->
                this.noise = noise

              speak: ->
                print this.noise
          </script>

          <aside class="notes">
            <p>Here's a simple class definition in Coffeescript. Let's see how it compiles down.</p>

            <p>This is similar to what we had earlier, and it works just the same.</p>

            <p>Now let's see some inheritance.</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Coffeescript Classes</h2>
          <script type="text/template">
            class Animal
              constructor: (noise) ->
                this.noise = noise

              speak: ->
                print this.noise

            class Dog extends Animal
              constructor: (name) ->
                super("bark")
                this.name = name

              comeHere: (name) ->
                switch name
                  when this.name then print "coming!"
                  else                print "nope!"
          </script>

          <aside class="notes">
            <p>This compiles to some pretty hairy code. However, it's nothing we wouldn't have to write ourselves. It works across browsers and it gives us what we want...</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Coffeescript Classes</h2>
          <script type="text/template">
            class Animal
              constructor: (noise) -> this.noise = noise
              speak: -> print this.noise

            class Dog extends Animal
              constructor: (name) ->
                super("bark")
                this.name = name

              comeHere: (name) ->
                switch name
                  when this.name then print "coming!"
                  else                print "nope!"

            bonzo = new Dog("Bonzo")
            fido = new Dog("Fido")

            print bonzo == fido
            print bonzo instance of Animal
            fido.comeHere("Bonzo")
            bonzo.speak()
          </script>

          <aside class="notes">
            <ul>
              <li>Separate instances</li>
              <li>Simple test for class membership via 'instanceof'</li>
              <li>Shared methods between the classes</li>
              <li>Method overriding and super calls work as well</li>
              <li>Static methods and variables</li>
            </ul>

            <p>Note that these classes are compatible with Backbone.js. Although Backbone isn't implemented in Coffeescript, its prototype chains are set up in this way. This means Coffeescript and Backbone go 100% hand in hand.</p>

            <p>The only thing that we haven't solved is the binding of <code>this</code> within methods, and that brings us to our crowning jewel...</p>
          </aside>
        </section>

        <section>
          <h2>Treasure #4: Fat Arrow</h2>
        </section>

        <section data-example>
          <h2 data-number>Fat Arrow</h2>
          <script type="text/template">
            this.x = 1

            func = (y) -> this.x + y

            print func(3)

            that = { x: 2 }
            print func.call(that, 3)
          </script>

          <aside class="notes">
            <p>One of my biggest bugbears with Javascript is the reliance on the "this" variable.</p>

            <p>The main issue is, of course, that "this" can be dynamically set by the calling function leading to odd results.</p>

            <p>Explain example. If this looks reasonable to you, look at the next slide...</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Fat Arrow</h2>
          <script type="text/template">
            class Animal
              constructor: (noise) ->
                this.noise = noise

              speak: ->
                print this.noise

            dog = new Animal("Bark")
            horse = new Animal("Whinney")

            dog.speak.call(horse)
          </script>

          <aside class="notes">
            <p>You can make a dog whinney. Unbelievable.</p>

            <p>How do we defend against bugs like this? We want to change the binding of "this" so that it is lexically bound rather than dynamically bound.</p>

            <p>We can get around this by binding the value of "this" at function definition time using "Function.prototype.bind".</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Fat Arrow</h2>
          <script type="text/template">
            this.x = 1

            func = (y) -> this.x + y

            print func(3)

            that = { x: 2 }
            print func.call(that, 3)
          </script>

          <aside class="notes">
            <p>Remember, every function has Function.prototype in its prototype chain. That has a method called "bind" that allows you to <em>fix</em> the value of "this".</p>

            <p>func = ((y) -> this.x + y).bind(this)</p>

            <p>Using "bind" is a major PITA in JS or Coffeescript. You have to explicitly remember to use it, wrap your function in parens, and att it to the end.</p>

            <p>It's also difficult to read in code because the "bind" clause is beneath all the code you care about.</p>

            <p>Fortunately, Coffeescript has a second function definition syntax that does the same thing.</p>

            <p>Let's go back to the objects/classes example...</p>
          </aside>
        </section>

        <section data-example>
          <h2 data-number>Fat Arrow</h2>
          <script type="text/template">
            class Animal
              constructor: (noise) ->
                this.noise = noise

              speak: ->
                print this.noise

            dog = new Animal("Bark")
            horse = new Animal("Whinney")

            dog.speak.call(horse)
          </script>

          <aside class="notes">
            <p>It's tricky to use "bind" here because we don't have a direct reference to the instance outside of our method/constructor definitions (it refers to the class, not the instance).</p>

            <p>Fortunately, Coffeescript interprets fat arrow in a method correctly and augments the compiled code accordingly.</p>

            <p>Note you mustn't use fat arrow on a constructor.</p>

            <p>Fat arrow is the single most time-saving thing in Coffeescript. It's absolutely priceless. And that's all for little treasures.</p>
          </aside>
        </section>

        <section data-markdown>
          <script type="text/template">
            ## Part 3: Eeeeevil!

            In which we examine potential gotchas

            <img src="img/nosferatu.jpg" alt="Eeeeevil">
          </script>
        </section>

        <section data-example>
          <h2>Variable shadowing</h2>
          <script type="text/template">
            # Declarations are hoisted to
            # the top of the current block

            name = "Dave"

            greetDave = () ->
              greeting = "Hello " + name
              print(greeting)

            # However, it is impossible to
            # shadow an outer variable declaration

            greetEveryone = () ->
              name = "everyone"
              greeting = "Hello " + name
              print(greeting)

            greetEveryone() # name set to "everyone"

            greetDave() # oh noes!
          </script>
        </section>
      </div>
    </div>

    <script src="lib/js/jquery.js"></script>
    <script src="lib/js/underscore.js"></script>
    <script src="lib/js/coffeescript.js"></script>
    <script src="lib/js/ace/ace.js"></script>
    <script src="lib/js/ace/theme-twilight.js"></script>
    <script src="lib/js/ace/mode-coffee.js"></script>
    <script src="lib/js/ace/mode-javascript.js"></script>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script type="text/coffeescript">
      do () ->
        headingNumbers = {}

        numberHeading = ->
          self = $(this)
          text = self.text()
          key = text.toLowerCase()
          number = headingNumbers[key] ? 1
          headingNumbers[key] = number + 1
          self.text(text + ' ' + number)

        whitespaceChars = [ ' ', '\t' ]

        isBlank = (line) ->
          /^[ \t]+$/.test(line)

        lineIndent = (line) ->
          match = line.match /^[ \t]*[^ \t]/
          if match then match[0].length - 1 else 1000

        trim = (script) ->
          script.replace(/^([ \t]*[\r\n])/, '')
                .replace(/([\r\n][ \t]*)$/, '')

        reindent = (script) ->
          lines  = script.split(/[\r\n]/)
          indent = _.min(_.map(lines, lineIndent))
          _.map(lines, (line) -> line.substring(indent)).join('\n')

        # Special treatment of Coffeescript compiler errors:
        exnMessage = (exn) ->
          if exn.location && exn.message
            "Error on line #{exn.location.first_line}: #{exn.message}"
          else
            exn.toString()

        evaluate = (script, mode) ->
          console.clear()
          try
            eval switch mode
              when 'coffee' then CoffeeScript.compile(reindent(trim(script)))
              else "(function() { #{trim(script)} })();"
          catch exn
            printError(exn)
          return

        initEditor = (parent, script, mode, theme = 'ace/theme/twilight') ->
          self = $(this)

          pane = $('<div>')
            .html(script)
            .appendTo(parent)
            .addClass("editor-pane #{mode}-editor-pane")

          editor = ace.edit(pane.get(0))
          editor.setTheme(theme)

          session = editor.getSession()
          session.setMode switch mode
                            when 'coffee' then 'ace/mode/coffee'
                            else 'ace/mode/javascript'
          session.setUseSoftTabs true
          session.setUseWrapMode true
          session.setTabSize 2

          pane.data('editor', editor)

          { pane, editor, session }

        initBuildButton = (parent) ->
          $('<button class="build">')
            .text("Build (Ctrl-B)")
            .appendTo(parent)
            .on('click', () -> $(this).trigger('build'))

        initEvalButton = (parent) ->
          $('<button class="eval">')
            .text("Eval (Ctrl-E)")
            .appendTo(parent)
            .on('click', () -> $(this).trigger('eval'))

        # Before we show any slides, we add a div.editor-panes
        # to fix their size. This prevents visual glitches when
        # we change slides.
        initExample = () ->
          self = $(this)

          if self.is('[data-example]')
            wrapper = $('<div>').addClass('editor-panes').appendTo(self)
            output  = $('<div>').addClass('output').appendTo(self)

          return

        showExample = () ->
          self = $(this)

          unless self.is('[data-example]')
            return

          mode   = self.data('mode') ? 'coffee'
          script = reindent(trim(self.find('script').html()))

          wrapper = self.find('.editor-panes')
          output  = self.find('.output')

          wrapper.on 'clear', ->
            lines = output.find('pre')
            if lines.length > 0
              wrapper.trigger('clearoutput')
            else
              wrapper.trigger('unzoom')

          wrapper.on 'clearoutput', ->
            lines = output.find('pre')
            lines.fadeOut('fast', () -> lines.remove())

          switch mode
            when 'coffee'
              coffee      = initEditor(wrapper, script, 'coffee')
              js          = initEditor(wrapper, '// Ctrl-B to see the Javascript...', 'js')
              buildButton = initBuildButton(wrapper)
              evalButton  = initEvalButton(wrapper)

              wrapper.addClass("full-width")
              coffee.editor.resize()
              js.pane.hide()

              builtOnce = false

              wrapper.on 'build', ->
                try
                  js.session.setValue(trim(CoffeeScript.compile(coffee.session.getValue(), bare: false)))
                catch exn
                  js.session.setValue "// " + exnMessage(exn)
                finally
                  # Make any keypress build from now on...
                  unless builtOnce
                    builtOnce = true

                    wrapper.removeClass('full-width')
                    js.pane.show()
                    coffee.editor.resize()
                    js.editor.resize()

                    coffee.pane.on('keyup', () -> wrapper.trigger('build'))

              wrapper.on 'eval', ->
                evaluate(coffee.editor.getSession().getValue(), 'coffee')

              wrapper.on 'zoom', (evt, mode) ->
                unless coffee.editor.isFocused() || js.editor.isFocused()
                  switch mode
                    when 'coffee' then coffee.editor.focus()
                    when 'js'     then js.editor.focus()

              wrapper.on 'unzoom', ->
                coffee.editor.blur()
                js.editor.blur()

            when 'js'
              js         = initEditor(wrapper, script, 'js')
              evalButton = initEvalButton(wrapper)

              wrapper.addClass("full-width")
              js.editor.resize()

              wrapper.on 'eval', ->
                evaluate(js.editor.getSession().getValue(), 'js')

              wrapper.on 'zoom', ->
                unless js.editor.isFocused() then js.editor.focus()

              wrapper.on 'unzoom', ->
                js.editor.blur()

          return

        hideExample = () ->
          slide = $(this)
          slide.find('.editor-pane').each () -> $(this).data('editor')?.destroy()
          slide.find('.editor-panes').off('build eval clear clearoutput zoom unzoom').html('')

        # Global keyup handler
        globalKeyUp = (evt) ->
          wrapper = $('section.present .editor-panes')
          focused = wrapper.find('.coffee-editor-pane').data('editor')?.isFocused() ||
                    wrapper.find('.js-editor-pane').data('editor')?.isFocused()

          switch evt.keyCode
            when 16, 17, 18, 91, 93 # Shift, ctrl, alt, command
              # Do nothing!
              break

            when 27 # Esc
              wrapper.trigger('clear')

            when 66 then if evt.ctrlKey # 'Ctrl-B'
              wrapper.trigger('build')

            when 69 then if evt.ctrlKey # 'Ctrl-E'
              wrapper.trigger('eval')

            when 37 then if !focused # Right arrow
              Reveal.prev()

            when 39 then if !focused # Right arrow
              Reveal.next()

            when 67 then if evt.ctrlKey and !focused # 'Ctrl-C'
              wrapper.trigger('zoom', 'coffee')

            when 74 then if evt.ctrlKey and !focused # 'Ctrl-J'
              wrapper.trigger('zoom', 'js')

            else
              wrapper.trigger('clearoutput')

        # Slide change handler for reveal.js:
        slideChanged = (evt) ->
          showExample.call(evt.currentSlide)
          hideExample.call(evt.previousSlide)
          console.clear()

        printStringify = (data) ->
          JSON.stringify(
            data
            (key, value) ->
              switch typeof(value)
                when "undefined" then "<undefined>"
                when "function"  then "<function>"
                when "number"
                  switch value
                    when Number.POSITIVE_INFINITY then "<positive-infinity>"
                    when Number.NEGATIVE_INFINITY then "<negative-infinity>"
                    else
                      if isNaN(value) then "<not-a-number>" else value
                else value
            2
          )

        window.print = (args...) ->
          console?.log?(args...)

          outputPane = $('section.present').find('.output')
          outputLine = $('<pre>').appendTo(outputPane).hide()
          outputCode = $('<code class="json">').appendTo(outputLine)

          outputCode.text(_.map(args, printStringify).join('\n'))

          hljs.highlightBlock(outputLine[0])

          outputLine.fadeIn('fast')

        window.printError = (exn) ->
          console?.error?(exn)

          outputPane = $('section.present').find('.output')
          outputLine = $('<pre class="error">').appendTo(outputPane).hide()
          outputCode = $('<code class="error">').appendTo(outputLine)

          message = exnMessage(exn)

          outputCode.text(message)

          outputLine.fadeIn('fast')

        window.prototypeChain = (obj) ->
          if obj?
            [ obj, prototypeChain(Object.getPrototypeOf(obj))... ]
          else
            [ obj ]

        $('body')
          .on('keyup', globalKeyUp)
          .find('[data-example]').each(initExample)

        $('body')
          .find('[data-number]').each(numberHeading)

        Reveal.initialize
          controls: true
          progress: true
          history: true
          center: true
          rollingLinks: false
          keyboard: false

          theme: Reveal.getQueryHash().theme
          transition: 'none'

          # Optional libraries used to extend on reveal.js
          dependencies: [
            {
              src: 'lib/js/classList.js'
              condition: () => !document.body.classList
            }
            {
              src: 'plugin/markdown/showdown.js'
              condition: () => !!document.querySelector('[data-markdown]')
            }
            {
              src: 'plugin/markdown/markdown.js'
              condition: () => !!document.querySelector('[data-markdown]')
            }
            {
              src: 'plugin/highlight/highlight.js'
              async: true
              callback: () => hljs.initHighlightingOnLoad()
            }
            # {
            #   src: 'plugin/zoom-js/zoom.js'
            #   async: true
            #   condition: () => !!document.body.classList
            # }
            {
              src: 'plugin/notes/notes.js'
              async: true
              condition: () => !!document.body.classList
            }
            # {
            #   src: 'plugin/search/search.js'
            #   async: true
            #   condition: () => !!document.body.classList
            # }
            # {
            #   src: 'plugin/remotes/remotes.js'
            #   async: true
            #   condition: () => !!document.body.classList
            # }
          ]

        Reveal.addEventListener 'slidechanged', slideChanged
    </script>

  </body>
</html>
